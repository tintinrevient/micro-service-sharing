## 在集群中测试Slow Query

### 准备测试数据

#### 从MySQL 5.x服务器导出数据

在terminal执行如下命令：
```
$ mysqldump --column-statistics=0 -u root -p -h 192.168.0.203 cemis_qj > ./cemis_dump.sql
```

#### 导入数据到MySQL 8.0服务器

InnoDB Cluster 导入数据：
```
$ mysql -u root -p -h 192.168.0.172 dbservice < ./cemis_dump.sql
```

NDB Cluster 导入数据：
```
$ mysql -u root -p -h 192.168.0.178 dbservice < ./cemis_dump.sql
```

### 导出/导入过程问题列举

在导入InnoDB集群的时候，遇到如下table没有主键的问题。在加上主键后，导入成功。
```
DROP TABLE IF EXISTS `textuserss`;
/*!40101 SET @saved_cs_client = @@character_set_client */;
SET character_set_client = utf8mb4 ;
CREATE TABLE `textuserss` (
`userName` text,
`deptName` text,
`companyName` text,
`userId` int(32) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
```

在导入NDB集群的时候，没有出现任何问题。

### 查询时间测试

在Slow Query里，query 1的执行时间是7.52秒。具体情况，参见 - [MySQL Slow Query Optimization](https://github.com/tintinrevient/micro-service-sharing/tree/master/devtool-mysql-slow-query-optimization)

在没有优化query 1语句的情况下，在InnoDB集群里，执行结果如下：
```
+----------------------------------+----------+--------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------+-----------+--------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------+-----------+---------------------+
| col_0_0_                         | col_1_0_ | col_2_0_     | col_3_0_                                                                                                                                                                                                                                                                                                                               | col_4_0_            | col_5_0_  | col_6_0_     | col_7_0_ | col_8_0_                                                                                                                                                                                                     | col_9_0_ | col_10_0_ | col_11_0_           |
+----------------------------------+----------+--------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------+-----------+--------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------+-----------+---------------------+
| 996718086c7945d48606bb9432d15249 |          | 视频上报     | NULL                                                                                                                                                                                                                                                                                                                                   | 2019-08-01 09:55:25 |           | 规划建设     | 01       | ApplicationFrameHost                                                                                                                                                                                         | PERSONAL | NULL      | 2019-08-01 09:55:48 |
| 64e48a53ad0944ca8462b3cf11a1cb7d |          | 部门移交     | NULL                                                                                                                                                                                                                                                                                                                                   | 2019-08-01 09:38:23 |           | 国土资源     | 01       | 就问你香不香                                                                                                                                                                                                 | PERSONAL | NULL      | 2019-08-01 09:38:55 |
| 2116ea69cb834a9186725c2720bd025e |          | 视频上报     | 作业区未划分洗车区和擦车区，洗车区未设置截水沟、三级沉淀池及污泥暂储设施;作业区地面、车辆进出口通道未采用混凝土硬化，作业区墙体及清水池立面未采用防渗漏材料覆盖;占用城镇道路和公共场所从事临时性机动车辆清洗保洁经营活动。                                                                                                             | 2019-07-30 08:59:56 |           | 城市管理     | 21       | 整个办案流程的样式修改的案例                                                                                                                                                                                 | PERSONAL | NULL      | 2019-08-01 02:14:18 |
| d0edeeccef194ac1a825d9ed93b9fb5f |          | 视频上报     | NULL                                                                                                                                                                                                                                                                                                                                   | 2019-08-01 01:35:11 |           | 农业开发     | 01       | test1                                                                                                                                                                                                        | PERSONAL | NULL      | 2019-08-01 01:35:33 |
| 5cb0adaededc42bb867cc793e0a29083 |          | 巡查发现     | NULL                                                                                                                                                                                                                                                                                                                                   | 2019-08-01 01:21:34 |           | 水务管理     | 11       | 8月第一条测试案件                                                                                                                                                                                            | PERSONAL | NULL      | 2019-08-01 01:22:05 |
| 59ac61b725be4681aa3e9cf82f46d4df |          | 视频上报     | NULL                                                                                                                                                                                                                                                                                                                                   | 2019-07-29 07:59:31 |           | 城市管理     | 11       | 新的一条测试案件                                                                                                                                                                                             | PERSONAL | NULL      | 2019-07-30 06:12:19 |
| cff8b67a994c46f0a59575dec3da14fd |          | 巡查发现     | 作业区未划分洗车区和擦车区，洗车区未设置截水沟、三级沉淀池及污泥暂储设施;在风景名胜和文物保护核心区、饮用水保护区设置清洗站                                                                                                                                                                                                            | 2019-07-30 06:05:08 | 王忘林    | 城市管理     | 44       | 王明在江河、湖泊、水库、运河、渠道内弃置、堆放阻碍行洪的物体和种植阻碍行洪的林木及高秆作物的处罚                                                                                                             | PERSONAL | NULL      | 2019-07-30 06:05:38 |
| 9838216bc5a74ee3b78e0b0886599eba |          | 视频上报     | 作业区未划分洗车区和擦车区，洗车区未设置截水沟、三级沉淀池及污泥暂储设施;作业区地面、车辆进出口通道未采用混凝土硬化，作业区墙体及清水池立面未采用防渗漏材料覆盖;在城区主次干道两侧道路红线控制区域设置清洗站                                                                                                                           | 2019-07-30 05:52:41 | 1221      | 城市管理     | 44       | 张三跟李四跟王五一起倒垃圾导致下水管道堵塞的案件                                                                                                                                                             | PERSONAL | NULL      | 2019-07-30 05:56:12 |
| 430b61e08f8745b584bc86cbf6f2fe9f |          | 部门移交     | NULL                                                                                                                                                                                                                                                                                                                                   | 2019-07-30 08:25:35 |           | 农业开发     | 01       | 农业开发                                                                                                                                                                                                     | PERSONAL | NULL      | 2019-07-29 08:25:54 |
| 8b8b6f551c5a45dbb2646c3e0dcbd0fb |          | 举报信访     | NULL                                                                                                                                                                                                                                                                                                                                   | 2019-07-29 08:11:08 |           | 交通运输     | 01       | 张某某在小区后面空地违规燃放烟花爆竹导致引燃一部分垃圾污染空气的案件张某某在小区后面空地违规燃放烟花爆竹导致引燃一部分垃圾污染空气的案件                                                                     | PERSONAL | NULL      | 2019-07-29 08:11:37 |
| 8b6462bcaba845298824896bbedff78b |          | 部门移交     | NULL                                                                                                                                                                                                                                                                                                                                   | 2019-07-29 08:09:53 |           | 文旅广新     | 01       | 张某某在小区后面空地违规燃放烟花爆竹导致引燃一部分垃圾污染空气的案件                                                                                                                                         | PERSONAL | NULL      | 2019-07-29 08:10:47 |
| 8f27d8e66e464e72856c399f1da3ef10 |          | 视频上报     | NULL                                                                                                                                                                                                                                                                                                                                   | 2019-07-30 08:07:17 |           | 国土资源     | 01       | 测试第三条案例                                                                                                                                                                                               | PERSONAL | NULL      | 2019-07-29 08:07:50 |
| 05580d60eb5841c09144fa12b7601997 |          | 部门移交     | 作业区未划分洗车区和擦车区，洗车区未设置截水沟、三级沉淀池及污泥暂储设施                                                                                                                                                                                                                                                               | 2019-07-26 07:10:29 |           | 城市管理     | 11       | 测试案件第二条                                                                                                                                                                                               | PERSONAL | NULL      | 2019-07-26 07:11:37 |
| 54b06fc2e7e04f88b4c41715511ed73b |          | 举报信访     | 未按照《建筑垃圾处置（排放）证》上载明的建筑垃圾种类、数量、排放期限排放建筑垃圾                                                                                                                                                                                                                                                       | 2019-07-25 02:47:53 |           | 水务管理     | 11       | 测试案件7月                                                                                                                                                                                                  | PERSONAL | NULL      | 2019-07-26 07:08:13 |
| 99506724750743e09216f80a5ff9ad15 |          | 举报信访     | NULL                                                                                                                                                                                                                                                                                                                                   | 2019-02-14 08:54:17 | NULL      | 城市管理     | 01       | 2                                                                                                                                                                                                            | UNIT     | 李        | 2019-02-14 16:54:42 |
| 5e049875cdd44506a0c86812dd0c48e9 |          | 举报信访     | 作业区地面、车辆进出口通道未采用混凝土硬化，作业区墙体及清水池立面未采用防渗漏材料覆盖                                                                                                                                                                                                                                                 | 2019-02-14 01:59:44 | NULL      | 城市管理     | 21       | cheshi1                                                                                                                                                                                                      | UNIT     | 李        | 2019-02-14 02:43:20 |
| 925a5cd7f5754fd5b53bb2dea141f9b6 |          | 举报信访     | NULL                                                                                                                                                                                                                                                                                                                                   | 2019-02-14 01:59:44 | NULL      | 城市管理     | 01       | cheshi2                                                                                                                                                                                                      | UNIT     | 李        | 2019-02-14 02:10:03 |
| 4528fb93bd2443aa904e2b128cec95f2 |          | 视频上报     | 雇佣不符合要求的驾驶员从事建筑垃圾运输活动                                                                                                                                                                                                                                                                                             | 2018-12-12 07:13:25 |           | 城市管理     | 62       | 5                                                                                                                                                                                                            | PERSONAL | NULL      | 2018-12-13 08:28:48 |
| ea809a9d9a324329b45b4b6d5a690a2d |          | 举报信访     | NULL                                                                                                                                                                                                                                                                                                                                   | 2018-12-12 06:11:13 |           | 城市管理     | 11       | 4                                                                                                                                                                                                            | PERSONAL | NULL      | 2018-12-12 06:11:58 |
| eea31b22cabb4a6ba2573f78fe8b779d |          | 视频上报     | 未将建筑垃圾交由本市建筑垃圾运输企业名录中的企业运输                                                                                                                                                                                                                                                                                   | 2018-12-12 05:56:18 |           | 城市管理     | 30       | 2                                                                                                                                                                                                            | PERSONAL | NULL      | 2018-12-12 05:59:34 |
| 82526624e8654115bf84980c20dbd700 |          | 视频上报     | 雇佣不符合要求的驾驶员从事建筑垃圾运输活动                                                                                                                                                                                                                                                                                             | 2018-12-12 03:03:03 |           | 城市管理     | 81       | 1                                                                                                                                                                                                            | PERSONAL | NULL      | 2018-12-12 05:54:54 |
+----------------------------------+----------+--------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------+-----------+--------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------+-----------+---------------------+
21 rows in set (0.34 sec)
```

在没有优化query 1语句的情况下，在NDB集群里，执行结果如下：
```
+----------------------------------+----------+--------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------+-----------+--------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------+-----------+---------------------+
| col_0_0_                         | col_1_0_ | col_2_0_     | col_3_0_                                                                                                                                                                                                                                                                                                                               | col_4_0_            | col_5_0_  | col_6_0_     | col_7_0_ | col_8_0_                                                                                                                                                                                                     | col_9_0_ | col_10_0_ | col_11_0_           |
+----------------------------------+----------+--------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------+-----------+--------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------+-----------+---------------------+
| 996718086c7945d48606bb9432d15249 |          | 视频上报     | NULL                                                                                                                                                                                                                                                                                                                                   | 2019-08-01 09:55:25 |           | 规划建设     | 01       | ApplicationFrameHost                                                                                                                                                                                         | PERSONAL | NULL      | 2019-08-01 09:55:48 |
| 64e48a53ad0944ca8462b3cf11a1cb7d |          | 部门移交     | NULL                                                                                                                                                                                                                                                                                                                                   | 2019-08-01 09:38:23 |           | 国土资源     | 01       | 就问你香不香                                                                                                                                                                                                 | PERSONAL | NULL      | 2019-08-01 09:38:55 |
| 2116ea69cb834a9186725c2720bd025e |          | 视频上报     | 作业区未划分洗车区和擦车区，洗车区未设置截水沟、三级沉淀池及污泥暂储设施;作业区地面、车辆进出口通道未采用混凝土硬化，作业区墙体及清水池立面未采用防渗漏材料覆盖;占用城镇道路和公共场所从事临时性机动车辆清洗保洁经营活动。                                                                                                             | 2019-07-30 08:59:56 |           | 城市管理     | 21       | 整个办案流程的样式修改的案例                                                                                                                                                                                 | PERSONAL | NULL      | 2019-08-01 02:14:18 |
| d0edeeccef194ac1a825d9ed93b9fb5f |          | 视频上报     | NULL                                                                                                                                                                                                                                                                                                                                   | 2019-08-01 01:35:11 |           | 农业开发     | 01       | test1                                                                                                                                                                                                        | PERSONAL | NULL      | 2019-08-01 01:35:33 |
| 5cb0adaededc42bb867cc793e0a29083 |          | 巡查发现     | NULL                                                                                                                                                                                                                                                                                                                                   | 2019-08-01 01:21:34 |           | 水务管理     | 11       | 8月第一条测试案件                                                                                                                                                                                            | PERSONAL | NULL      | 2019-08-01 01:22:05 |
| 59ac61b725be4681aa3e9cf82f46d4df |          | 视频上报     | NULL                                                                                                                                                                                                                                                                                                                                   | 2019-07-29 07:59:31 |           | 城市管理     | 11       | 新的一条测试案件                                                                                                                                                                                             | PERSONAL | NULL      | 2019-07-30 06:12:19 |
| cff8b67a994c46f0a59575dec3da14fd |          | 巡查发现     | 作业区未划分洗车区和擦车区，洗车区未设置截水沟、三级沉淀池及污泥暂储设施;在风景名胜和文物保护核心区、饮用水保护区设置清洗站                                                                                                                                                                                                            | 2019-07-30 06:05:08 | 王忘林    | 城市管理     | 44       | 王明在江河、湖泊、水库、运河、渠道内弃置、堆放阻碍行洪的物体和种植阻碍行洪的林木及高秆作物的处罚                                                                                                             | PERSONAL | NULL      | 2019-07-30 06:05:38 |
| 9838216bc5a74ee3b78e0b0886599eba |          | 视频上报     | 作业区未划分洗车区和擦车区，洗车区未设置截水沟、三级沉淀池及污泥暂储设施;作业区地面、车辆进出口通道未采用混凝土硬化，作业区墙体及清水池立面未采用防渗漏材料覆盖;在城区主次干道两侧道路红线控制区域设置清洗站                                                                                                                           | 2019-07-30 05:52:41 | 1221      | 城市管理     | 44       | 张三跟李四跟王五一起倒垃圾导致下水管道堵塞的案件                                                                                                                                                             | PERSONAL | NULL      | 2019-07-30 05:56:12 |
| 430b61e08f8745b584bc86cbf6f2fe9f |          | 部门移交     | NULL                                                                                                                                                                                                                                                                                                                                   | 2019-07-30 08:25:35 |           | 农业开发     | 01       | 农业开发                                                                                                                                                                                                     | PERSONAL | NULL      | 2019-07-29 08:25:54 |
| 8b8b6f551c5a45dbb2646c3e0dcbd0fb |          | 举报信访     | NULL                                                                                                                                                                                                                                                                                                                                   | 2019-07-29 08:11:08 |           | 交通运输     | 01       | 张某某在小区后面空地违规燃放烟花爆竹导致引燃一部分垃圾污染空气的案件张某某在小区后面空地违规燃放烟花爆竹导致引燃一部分垃圾污染空气的案件                                                                     | PERSONAL | NULL      | 2019-07-29 08:11:37 |
| 8b6462bcaba845298824896bbedff78b |          | 部门移交     | NULL                                                                                                                                                                                                                                                                                                                                   | 2019-07-29 08:09:53 |           | 文旅广新     | 01       | 张某某在小区后面空地违规燃放烟花爆竹导致引燃一部分垃圾污染空气的案件                                                                                                                                         | PERSONAL | NULL      | 2019-07-29 08:10:47 |
| 8f27d8e66e464e72856c399f1da3ef10 |          | 视频上报     | NULL                                                                                                                                                                                                                                                                                                                                   | 2019-07-30 08:07:17 |           | 国土资源     | 01       | 测试第三条案例                                                                                                                                                                                               | PERSONAL | NULL      | 2019-07-29 08:07:50 |
| 05580d60eb5841c09144fa12b7601997 |          | 部门移交     | 作业区未划分洗车区和擦车区，洗车区未设置截水沟、三级沉淀池及污泥暂储设施                                                                                                                                                                                                                                                               | 2019-07-26 07:10:29 |           | 城市管理     | 11       | 测试案件第二条                                                                                                                                                                                               | PERSONAL | NULL      | 2019-07-26 07:11:37 |
| 54b06fc2e7e04f88b4c41715511ed73b |          | 举报信访     | 未按照《建筑垃圾处置（排放）证》上载明的建筑垃圾种类、数量、排放期限排放建筑垃圾                                                                                                                                                                                                                                                       | 2019-07-25 02:47:53 |           | 水务管理     | 11       | 测试案件7月                                                                                                                                                                                                  | PERSONAL | NULL      | 2019-07-26 07:08:13 |
| 99506724750743e09216f80a5ff9ad15 |          | 举报信访     | NULL                                                                                                                                                                                                                                                                                                                                   | 2019-02-14 08:54:17 | NULL      | 城市管理     | 01       | 2                                                                                                                                                                                                            | UNIT     | 李        | 2019-02-14 16:54:42 |
| 5e049875cdd44506a0c86812dd0c48e9 |          | 举报信访     | 作业区地面、车辆进出口通道未采用混凝土硬化，作业区墙体及清水池立面未采用防渗漏材料覆盖                                                                                                                                                                                                                                                 | 2019-02-14 01:59:44 | NULL      | 城市管理     | 21       | cheshi1                                                                                                                                                                                                      | UNIT     | 李        | 2019-02-14 02:43:20 |
| 925a5cd7f5754fd5b53bb2dea141f9b6 |          | 举报信访     | NULL                                                                                                                                                                                                                                                                                                                                   | 2019-02-14 01:59:44 | NULL      | 城市管理     | 01       | cheshi2                                                                                                                                                                                                      | UNIT     | 李        | 2019-02-14 02:10:03 |
| 4528fb93bd2443aa904e2b128cec95f2 |          | 视频上报     | 雇佣不符合要求的驾驶员从事建筑垃圾运输活动                                                                                                                                                                                                                                                                                             | 2018-12-12 07:13:25 |           | 城市管理     | 62       | 5                                                                                                                                                                                                            | PERSONAL | NULL      | 2018-12-13 08:28:48 |
| ea809a9d9a324329b45b4b6d5a690a2d |          | 举报信访     | NULL                                                                                                                                                                                                                                                                                                                                   | 2018-12-12 06:11:13 |           | 城市管理     | 11       | 4                                                                                                                                                                                                            | PERSONAL | NULL      | 2018-12-12 06:11:58 |
| eea31b22cabb4a6ba2573f78fe8b779d |          | 视频上报     | 未将建筑垃圾交由本市建筑垃圾运输企业名录中的企业运输                                                                                                                                                                                                                                                                                   | 2018-12-12 05:56:18 |           | 城市管理     | 30       | 2                                                                                                                                                                                                            | PERSONAL | NULL      | 2018-12-12 05:59:34 |
| 82526624e8654115bf84980c20dbd700 |          | 视频上报     | 雇佣不符合要求的驾驶员从事建筑垃圾运输活动                                                                                                                                                                                                                                                                                             | 2018-12-12 03:03:03 |           | 城市管理     | 81       | 1                                                                                                                                                                                                            | PERSONAL | NULL      | 2018-12-12 05:54:54 |
+----------------------------------+----------+--------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------+-----------+--------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------+-----------+---------------------+
21 rows in set (0.44 sec)
```

### Reference

* https://serverfault.com/questions/912162/mysqldump-throws-unknown-table-column-statistics-in-information-schema-1109
